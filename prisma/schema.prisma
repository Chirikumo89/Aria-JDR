// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// Modèle pour les utilisateurs
model User {
  id        String   @id @default(cuid())
  username  String   @unique
  role      String   @default("player") // "player" ou "mj"
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Relations
  characters Character[]
  diceRolls  DiceRoll[]
  
  @@map("users")
}

// Modèle pour les parties de JDR
model Game {
  id          String   @id @default(cuid())
  name        String
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Caisse commune (accessible à tous les joueurs de la partie)
  commonTreasuryCrowns   Int @default(0)  // Couronnes (or) - monnaie principale
  commonTreasuryOrbs     Int @default(0)  // Orbes (argent) - 1 couronne = 10 orbes
  commonTreasuryScepters  Int @default(0)  // Sceptres (cuivre) - 1 orbe = 10 sceptres
  commonTreasuryKings     Int @default(0)  // Rois (fer) - 1 sceptre = 10 rois
  
  // Relations
  characters    Character[]
  diceRolls     DiceRoll[]
  gameSessions  GameSession[]
  cards         Card[]
  transactions  Transaction[]
  commonTreasuryTransactions CommonTreasuryTransaction[]
  vehicles      Vehicle[]
  crateRequests CrateRequest[]
  vehicleRequests VehicleRequest[]
  
  @@map("games")
}

  // Modèle pour les personnages
  model Character {
    id          String   @id @default(cuid())
    name        String
    playerName  String
    function    String?  // Fonction du personnage (ex: Barde (Voleur))
    age         Int?
  
  // Points de vie et combat
  lifePoints     Int?     // Points de vie maximum
  currentLifePoints Int?  // Points de vie actuels
  wounds         Int?     // Blessures
  protection     Int?     // Protection
  
    // Armes (3 armes max)
    weapon1     String?  // Arme 1
    damage1     String?  // Dégâts arme 1 (ex: 1d4)
    weapon2     String?  // Arme 2
    damage2     String?  // Dégâts arme 2 (ex: 1d6)
    weapon3     String?  // Arme 3
    damage3     String?  // Dégâts arme 3 (ex: 2d4)
  
  // Caractéristiques
  strength    Int?     // Force
  dexterity   Int?     // Dextérité
  endurance   Int?     // Endurance
  intelligence Int?    // Intelligence
  charisma    Int?     // Charisme
  
  // Déclarations personnelles
  awesomeBecause String? // "JE SUIS GÉNIAL-E PARCE QUE..."
  societyProblems String? // "MAIS LA SOCIÉTÉ A DES PROBLÈMES AVEC MOI PARCE QUE..."
  
  // Compétences (20 compétences de base)
  skills      Json?    // Compétences avec scores et liens
  
  // Compétences spéciales
  specialSkills Json?  // Compétences spéciales
  
  // Possessions et notes
  possessions String?  // Possessions
  notes       String?  // Notes
  
  // Système monétaire Aria
  crowns      Int      @default(0)  // Couronnes (or) - monnaie principale
  orbs        Int      @default(0)  // Orbes (argent) - 1 couronne = 10 orbes
  scepters    Int      @default(0)  // Sceptres (cuivre) - 1 orbe = 10 sceptres
  kings       Int      @default(0)  // Rois (fer) - 1 sceptre = 10 rois
  
  // Anciens champs pour compatibilité
  level       Int      @default(1)
  class       String?
  race        String?
  stats       Json?    // Pour stocker les statistiques du personnage
  inventory   Json?    // Pour stocker l'inventaire
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  gameId      String
  game        Game     @relation(fields: [gameId], references: [id], onDelete: Cascade)
  userId      String?
  user        User?    @relation(fields: [userId], references: [id], onDelete: SetNull)
  diceRolls   DiceRoll[]
  characterCards CharacterCard[]
  transactions Transaction[]
  
  @@map("characters")
}

// Modèle pour les lancers de dés
model DiceRoll {
  id        String   @id @default(cuid())
  diceType  String   // "d6", "d10", "d100", etc.
  result    Int
  tens      Int?     // Pour les d100
  units     Int?     // Pour les d100
  createdAt DateTime @default(now())
  
  // Relations
  gameId      String
  game        Game     @relation(fields: [gameId], references: [id], onDelete: Cascade)
  characterId String?
  character   Character? @relation(fields: [characterId], references: [id], onDelete: SetNull)
  userId      String?
  user        User?    @relation(fields: [userId], references: [id], onDelete: SetNull)
  
  @@map("dice_rolls")
}

// Modèle pour les sessions de jeu
model GameSession {
  id          String   @id @default(cuid())
  name        String
  description String?
  date        DateTime
  notes       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  gameId      String
  game        Game     @relation(fields: [gameId], references: [id], onDelete: Cascade)
  
  @@map("game_sessions")
}

// Modèle pour les cartes
model Card {
  id          String   @id @default(cuid())
  name        String
  description String?
  image       String?  // Chemin vers l'image de la carte
  type        String?  // Type de carte (objet, sort, compétence, etc.)
  rarity      String?  // Rareté de la carte
  cost        Int?     // Coût d'achat de la carte
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  gameId      String
  game        Game     @relation(fields: [gameId], references: [id], onDelete: Cascade)
  characterCards CharacterCard[]
  
  @@map("cards")
}

// Modèle pour l'attribution des cartes aux personnages
model CharacterCard {
  id          String   @id @default(cuid())
  acquiredAt  DateTime @default(now()) // Date d'acquisition
  notes       String?  // Notes sur l'acquisition
  
  // Relations
  characterId String
  character   Character @relation(fields: [characterId], references: [id], onDelete: Cascade)
  cardId      String
  card        Card     @relation(fields: [cardId], references: [id], onDelete: Cascade)
  
  @@unique([characterId, cardId]) // Un personnage ne peut avoir qu'une seule instance de chaque carte
  @@map("character_cards")
}

// Modèle pour les transactions monétaires
model Transaction {
  id          String   @id @default(cuid())
  type        String   // "payment", "income", "conversion", etc.
  amount      Int      // Montant de la transaction
  currency    String   // Type de monnaie utilisée (crowns, orbs, scepters, kings)
  description String?  // Description de la transaction
  createdAt   DateTime @default(now())
  
  // Relations
  characterId String
  character   Character @relation(fields: [characterId], references: [id], onDelete: Cascade)
  gameId      String
  game        Game     @relation(fields: [gameId], references: [id], onDelete: Cascade)
  
  @@map("transactions")
}

// Modèle pour les transactions de la caisse commune
model CommonTreasuryTransaction {
  id          String   @id @default(cuid())
  type        String   // "payment", "income", "conversion", etc.
  amount      Int      // Montant de la transaction
  currency    String   // Type de monnaie utilisée (crowns, orbs, scepters, kings)
  description String?  // Description de la transaction
  username    String   // Pseudo de la personne qui fait la transaction
  createdAt   DateTime @default(now())
  
  // Relations
  gameId      String
  game        Game     @relation(fields: [gameId], references: [id], onDelete: Cascade)
  
  @@map("common_treasury_transactions")
}

// Modèle pour les véhicules (inventaires communs aux joueurs)
model Vehicle {
  id          String   @id @default(cuid())
  name        String   // Nom du véhicule (libre)
  maxCrates   Int      @default(1)  // Nombre max de cagettes (modifiable par MJ uniquement)
  crates      Json?    // Liste des cagettes (nom uniquement)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  gameId      String
  game        Game     @relation(fields: [gameId], references: [id], onDelete: Cascade)
  crateRequests CrateRequest[]
  
  @@map("vehicles")
}

// Modèle pour les demandes d'augmentation de capacité de cagettes
model CrateRequest {
  id             String   @id @default(cuid())
  requestedSlots Int      @default(1) // Nombre de slots supplémentaires demandés
  reason         String?  // Raison de la demande (optionnel)
  status         String   @default("pending") // pending, approved, rejected
  username       String   // Pseudo du joueur qui fait la demande
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  
  // Relations
  vehicleId   String
  vehicle     Vehicle  @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  gameId      String
  game        Game     @relation(fields: [gameId], references: [id], onDelete: Cascade)
  
  @@map("crate_requests")
}

// Modèle pour les demandes de création de véhicule
model VehicleRequest {
  id           String   @id @default(cuid())
  vehicleName  String   // Nom du véhicule demandé
  maxCrates    Int      @default(1) // Capacité demandée
  reason       String?  // Raison de la demande (optionnel)
  status       String   @default("pending") // pending, approved, rejected
  username     String   // Pseudo du joueur qui fait la demande
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  // Relations
  gameId      String
  game        Game     @relation(fields: [gameId], references: [id], onDelete: Cascade)
  
  @@map("vehicle_requests")
}
